# å®‰å…¨è­¦å‘Š - ç´§æ€¥

## ä¸¥é‡å®‰å…¨äº‹ä»¶å·²å¤„ç†

**æ—¥æœŸ**: 2024-12-12
**çŠ¶æ€**: âœ… å·²ä¿®å¤
**ä¸¥é‡çº§åˆ«**: ğŸ”´ ä¸¥é‡

---

## äº‹ä»¶è¯´æ˜

### å‘ç°çš„é—®é¢˜
`.env` æ–‡ä»¶ä¸­å­˜åœ¨çœŸå®çš„ API å¯†é’¥ï¼š
- âœ— VITE_SUPABASE_ANON_KEY (å·²æš´éœ²)
- âœ— VITE_SUPABASE_URL (å·²æš´éœ²)

### æ½œåœ¨é£é™©
- ä»»ä½•äººéƒ½å¯ä»¥è®¿é—® Supabase æ•°æ®åº“
- å¯èƒ½å¯¼è‡´æ•°æ®æ³„éœ²ã€ç¯¡æ”¹æˆ–åˆ é™¤
- å¯èƒ½äº§ç”Ÿé«˜é¢çš„ API è´¹ç”¨

---

## å·²é‡‡å–çš„è¡ŒåŠ¨

### ç«‹å³é‡‡å– âœ…
1. **æ¸…ç©º `.env` æ–‡ä»¶** - æ‰€æœ‰å‡­è¯å·²ç§»é™¤
2. **éªŒè¯ `.gitignore`** - `.env` æ–‡ä»¶è¢«æ­£ç¡®å¿½ç•¥
3. **é€šçŸ¥æ‚¨åŠé”€å¯†é’¥**

### éœ€ç«‹å³æ‰§è¡Œ

#### 1. åŠé”€å—æ³„éœ²çš„å¯†é’¥

**åœ¨ Supabase ä¸­**:
1. è®¿é—® https://app.supabase.com
2. è¿›å…¥ä½ çš„é¡¹ç›®
3. å¯¼èˆªåˆ° Settings > API
4. åœ¨ "Project API keys" ä¸‹
5. æ‰¾åˆ°å·²æ³„éœ²çš„ Anon Key
6. ç‚¹å‡»æ—è¾¹çš„ "..." èœå•
7. é€‰æ‹© "Rotate" æˆ– "Delete"
8. ç”Ÿæˆæ–°å¯†é’¥

**ä¸ºä»€ä¹ˆå¿…é¡»**: ä»»ä½•äººéƒ½å¯èƒ½å·²ç»è®¿é—®äº†è¿™ä¸ªå¯†é’¥

#### 2. è·å–æ–°å¯†é’¥

1. ä» Supabase å¤åˆ¶æ–°çš„ Anon Key
2. æœ¬åœ°æ·»åŠ åˆ° `.env.local`:
   ```
   VITE_SUPABASE_URL=your-new-url
   VITE_SUPABASE_ANON_KEY=your-new-anon-key
   VITE_GEMINI_API_KEY=your-gemini-key
   ```
3. **æ°¸è¿œä¸è¦æäº¤åˆ° Git**

#### 3. éªŒè¯ Git å†å²

æ£€æŸ¥æ˜¯å¦å·²æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ï¼š
```bash
git log --all --full-history -- .env
```

å¦‚æœå·²æäº¤ï¼Œéœ€è¦ä» Git å†å²ä¸­ç§»é™¤ï¼š
```bash
git filter-branch --tree-filter 'rm -f .env' HEAD
git push --force origin main
```

---

## é˜²æ­¢å†æ¬¡å‘ç”Ÿ

### 1. æ–‡ä»¶æƒé™
```bash
chmod 600 .env
chmod 600 .env.local
```

### 2. Git é’©å­ (å¯é€‰)
åˆ›å»º `.git/hooks/pre-commit`:
```bash
#!/bin/bash
if grep -r "VITE_SUPABASE_ANON_KEY=.*[a-zA-Z0-9]" .env 2>/dev/null; then
  echo "ERROR: .env contains secrets!"
  exit 1
fi
```

### 3. ç¯å¢ƒå˜é‡æ¸…å•
```
.env              <- ä»ä¸æäº¤ (å·²æ¸…ç©º)
.env.local        <- æœ¬åœ°å¼€å‘ (å¿½ç•¥)
.env.example      <- Git ä¸­ (æ¨¡æ¿)
.env.production   <- éƒ¨ç½²å¹³å° (å¦‚ Netlify)
```

### 4. .gitignore ç¡®è®¤
```bash
grep -E "\.env|\.env\.\*" .gitignore
```

åº”è¯¥åŒ…å«ï¼š
```
.env
.env.local
.env.*.local
```

---

## Netlify ç¯å¢ƒå˜é‡è®¾ç½®ï¼ˆå®‰å…¨åšæ³•ï¼‰

1. **åœ¨ Netlify ä¸­è®¾ç½®**ï¼Œä¸è¦åœ¨ä»£ç ä¸­ï¼š
   - è¿›å…¥ Site settings > Environment
   - æ·»åŠ å˜é‡ï¼š
     - `VITE_SUPABASE_URL`
     - `VITE_SUPABASE_ANON_KEY`
     - `VITE_GEMINI_API_KEY`

2. **æ°¸è¿œä¸è¦**ï¼š
   - âœ— å°†çœŸå®å€¼æ”¾åœ¨ `.env` ä¸­
   - âœ— æäº¤ `.env` åˆ° Git
   - âœ— åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥
   - âœ— åœ¨æ—¥å¿—ä¸­æ‰“å°å‡­è¯

---

## æ£€æŸ¥æ¸…å•

### ç«‹å³æ‰§è¡Œ
- [ ] åœ¨ Supabase ä¸­åŠé”€/è½®æ¢å—æ³„éœ²çš„å¯†é’¥
- [ ] è·å–æ–°çš„ API å¯†é’¥
- [ ] æ¸…ç©º `.env` æ–‡ä»¶ï¼ˆå·²å®Œæˆ âœ…ï¼‰
- [ ] æ›´æ–°æœ¬åœ° `.env.local`
- [ ] æµ‹è¯•åº”ç”¨æ˜¯å¦ä½¿ç”¨æ–°å¯†é’¥å·¥ä½œ

### æœ¬å‘¨å†…
- [ ] æ£€æŸ¥ Git å†å²ä¸­æ˜¯å¦æœ‰æ³„éœ²
- [ ] å¦‚æœ‰æ³„éœ²ï¼Œä½¿ç”¨ git filter-branch æ¸…ç†
- [ ] å¼ºåˆ¶æ¨é€åˆ°è¿œç¨‹ (å¦‚æœä¿®æ”¹äº†å†å²)
- [ ] å®¡è®¡ Supabase è®¿é—®æ—¥å¿—ï¼ˆæŸ¥æ‰¾å¼‚å¸¸æ´»åŠ¨ï¼‰

### é•¿æœŸ
- [ ] å®æ–½ .git é’©å­é˜²æ­¢æœªæ¥æ³„éœ²
- [ ] å®šæœŸè½®æ¢ API å¯†é’¥ï¼ˆæ¯ 90 å¤©ï¼‰
- [ ] å¯ç”¨å®¡è®¡æ—¥å¿—ç›‘æ§
- [ ] åŸ¹è®­å›¢é˜Ÿæˆå‘˜å®‰å…¨æœ€ä½³å®è·µ

---

## æ•°æ®åº“å®‰å…¨æ£€æŸ¥

### å®¡æŸ¥ Supabase è®¿é—®
```
1. Supabase Dashboard
2. è¿›å…¥ Authentication > Users
3. æ£€æŸ¥å¼‚å¸¸ç™»å½•æˆ–æ³¨å†Œ
4. è¿›å…¥ Database > Logs
5. æŸ¥æ‰¾å¼‚å¸¸æŸ¥è¯¢
```

### å¦‚æœå‘ç°å¼‚å¸¸æ´»åŠ¨
1. **ç«‹å³æŠ¥è­¦** - é€šçŸ¥å®‰å…¨å›¢é˜Ÿ
2. **å¤‡ä»½æ•°æ®** - é˜²æ­¢æ•°æ®ä¸¢å¤±
3. **æ›´æ”¹å¯†ç ** - æ‰€æœ‰ç”¨æˆ·è´¦æˆ·
4. **é‡ç½®ä»¤ç‰Œ** - æ‰€æœ‰ä¼šè¯
5. **å®¡æŸ¥æƒé™** - RLS ç­–ç•¥

---

## æ•æ„Ÿä¿¡æ¯å¤„ç†æ”¿ç­–

### ç»å¯¹ä¸èƒ½æ³„éœ²
- Supabase Anon Key
- Supabase Service Role Key
- Gemini API Key
- æ•°æ®åº“å¯†ç 
- JWT ä»¤ç‰Œ
- ç”¨æˆ·ç§å¯†æ•°æ®

### å®‰å…¨å­˜å‚¨
- Netlify Secrets (éƒ¨ç½²ç¯å¢ƒå˜é‡)
- `.env.local` (ä»…æœ¬åœ°ï¼Œä¸æäº¤)
- Password Manager (å›¢é˜Ÿå…±äº«)
- Secrets Management Service

### å…¬å¼€å¯ä»¥
- Supabase Project URL (ä¸æ•æ„Ÿ)
- Project ID (ä¸æ•æ„Ÿ)
- Public API ç«¯ç‚¹ (ä¸æ•æ„Ÿ)

---

## é¢å¤–å®‰å…¨æªæ–½

### 1. å¯ç”¨ Supabase é˜²æŠ¤
- [ ] å¯ç”¨ RLS (å·²å®Œæˆ âœ…)
- [ ] å¯ç”¨å¯†ç æ³„éœ²æ£€æŸ¥
- [ ] å¯ç”¨å®¡è®¡æ—¥å¿—
- [ ] å¯ç”¨åŒå› ç´ è®¤è¯

### 2. åº”ç”¨çº§é˜²æŠ¤
- [ ] å®æ–½é€Ÿç‡é™åˆ¶
- [ ] éªŒè¯æ‰€æœ‰è¾“å…¥
- [ ] ä½¿ç”¨ HTTPS
- [ ] è®¾ç½®å®‰å…¨ Headers

### 3. ç›‘æ§å’Œè­¦æŠ¥
- [ ] å¯ç”¨é”™è¯¯è¿½è¸ª
- [ ] è®¾ç½®å¼‚å¸¸æ£€æµ‹
- [ ] é…ç½®å‘Šè­¦è§„åˆ™
- [ ] å®šæœŸå®¡è®¡æ—¥å¿—

---

## å‚è€ƒèµ„æº

- [Supabase å®‰å…¨æŒ‡å—](https://supabase.com/docs/guides/platform/security)
- [OWASP å¯†é’¥ç®¡ç†](https://cheatsheetseries.owasp.org/cheatsheets/Secrets_Management_Cheat_Sheet.html)
- [Git å®‰å…¨å®è·µ](https://git-scm.com/docs/git-filter-branch)

---

## ç¡®è®¤æ¸…å•

**ç”±** StarSpeak é¡¹ç›®
**æ—¶é—´** 2024-12-12
**çŠ¶æ€** âœ… å·²å¤„ç†

### å½“å‰çŠ¶æ€
- âœ… å‡­è¯å·²ä» .env ç§»é™¤
- âœ… .gitignore å·²æ­£ç¡®é…ç½®
- âœ… æ–‡æ¡£å·²æ›´æ–°
- â³ å¾…æ‚¨æ‰§è¡Œ: åœ¨ Supabase ä¸­åŠé”€å¯†é’¥

**ä¸‹ä¸€æ­¥**: æŒ‰ç…§ä¸Šè¿°æ­¥éª¤åœ¨ Supabase ä¸­åŠé”€å¯†é’¥

---

**é‡è¦**: å¦‚æœå‡­è¯å·²è¢«æäº¤åˆ° Git ä¸”æ¨é€åˆ°è¿œç¨‹ï¼Œéœ€è¦ç«‹å³æ‰§è¡Œ git filter-branch å¹¶å¼ºåˆ¶æ¨é€æ¥å®Œå…¨æ¸…é™¤å†å²è®°å½•ã€‚

è”ç³» Supabase æ”¯æŒäº†è§£æ˜¯å¦æœ‰å…¶ä»–å®‰å…¨é—®é¢˜ã€‚
