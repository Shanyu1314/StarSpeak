# 词典导入说明

本文档说明如何使用 `import_vocab_sources.py` 脚本将高中、考研、托福词汇导入到数据库。

## 📋 前置要求

### 1. 安装Python依赖

```bash
cd scripts
pip install -r requirements.txt
```

如果 `requirements.txt` 不存在，手动安装：

```bash
pip install supabase python-dotenv
```

### 2. 配置环境变量

确保项目根目录的 `.env` 文件包含Supabase配置：

```env
VITE_SUPABASE_URL=你的Supabase项目URL
VITE_SUPABASE_ANON_KEY=你的Supabase匿名密钥
```

### 3. 准备词典文件

确认以下文件存在于 `scripts/data/` 目录：

- `2_高中-乱序 copy.txt` - 高中词汇
- `5_考研-乱序 copy.txt` - 考研词汇
- `6_托福-乱序 copy.txt` - 托福词汇

**文件格式要求：**
每行一个单词，格式为：
```
单词<TAB>词性. 中文释义；其他释义
```

例如：
```
effort    n. 努力；成就
adapt     v. 使适应；改编
```

## 🚀 使用步骤

### 步骤1：进入scripts目录

```bash
cd scripts
```

### 步骤2：加载环境变量

**macOS/Linux:**
```bash
export $(cat ../.env | grep -v '^#' | xargs)
```

**Windows (PowerShell):**
```powershell
Get-Content ../.env | ForEach-Object {
    if ($_ -match '^([^#][^=]+)=(.*)$') {
        [Environment]::SetEnvironmentVariable($matches[1], $matches[2], 'Process')
    }
}
```

### 步骤3：运行导入脚本

```bash
python import_vocab_sources.py
```

## 📊 导入过程

脚本会自动执行以下操作：

1. **连接数据库** - 使用环境变量连接到Supabase
2. **读取文件** - 依次读取三个词典文件
3. **解析单词** - 提取单词和中文释义
4. **智能导入**：
   - 如果单词不存在 → 插入新记录，添加对应词源标签
   - 如果单词已存在 → 更新词源标签（合并不重复）
5. **批量处理** - 使用批量操作提升性能

## 📝 输出示例

```
============================================================
📖 词典导入工具
============================================================
✅ 已连接到Supabase

============================================================
处理文件: scripts/data/2_高中-乱序 copy.txt
词源标签: 高中

📚 处理 [高中] 词汇...
   共 3500 个单词
   ✨ 需要插入: 3200 个
   🔄 需要更新标签: 300 个
   ✅ 已插入 3200/3200
   ✅ 已更新 300 个单词的标签

============================================================
✨ 导入完成！
============================================================
```

## ✅ 验证导入结果

导入完成后，你可以：

1. **在应用中查词** - 打开应用，使用离线查词功能
2. **查看词源标签** - 查询的单词会显示"高中"、"考研"、"托福"等标签
3. **检查数据库** - 在Supabase控制台查看 `words_unified` 表

## 🔧 常见问题

### Q: 提示"文件不存在"

**A:** 检查文件路径是否正确，确保txt文件在 `scripts/data/` 目录下。

### Q: 提示"连接Supabase失败"

**A:**
1. 检查 `.env` 文件是否存在
2. 确认环境变量是否正确加载
3. 验证Supabase URL和密钥是否有效

### Q: 导入速度慢

**A:** 脚本使用批量操作已优化性能。首次导入较慢（约3-5分钟），后续更新会快很多。

### Q: 部分单词导入失败

**A:**
1. 检查txt文件编码是否为UTF-8
2. 确认文件格式是否正确（tab分隔）
3. 查看错误日志，根据提示修复问题

## 📌 注意事项

1. **重复运行安全** - 脚本可以重复运行，不会创建重复记录
2. **增量更新** - 如果添加新词源，只需更新对应txt文件后重新运行
3. **数据备份** - 首次运行前建议备份数据库
4. **网络连接** - 确保网络连接稳定，避免中断导入过程

## 🎯 下一步

导入完成后：
1. 重启应用，测试离线查词功能
2. 查询已导入的单词，验证词源标签显示
3. 如有问题，查看控制台日志进行排查
